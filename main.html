<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Ordering Page — Clean Demo</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root{--bg:#f6f7f9;--card:#ffffff;--muted:#6b7280;--accent:#111827}
    *{box-sizing:border-box}body{font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial; margin:0;background:var(--bg);color:var(--accent);}
    .wrap{max-width:980px;margin:36px auto;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{font-size:20px;margin:0}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:14px}
    .card{background:var(--card);border-radius:12px;padding:12px;box-shadow:0 6px 16px rgba(15,23,42,0.04);position:relative;display:flex;flex-direction:column;gap:8px}
    .img{height:140px;border-radius:8px;display:flex;align-items:center;justify-content:center;background:linear-gradient(180deg,#eef2ff, #ffffff);overflow:hidden}
    .img svg{width:80%;height:80%}
    .meta{display:flex;justify-content:space-between;align-items:center}
    .title{font-weight:600;font-size:15px}
    .desc{font-size:13px;color:var(--muted)}
    .price{font-weight:600}
    .controls{display:flex;gap:8px;align-items:center}
    input[type=number]{width:68px;padding:6px;border-radius:8px;border:1px solid #e5e7eb}
    button{background:#111827;color:white;border:none;padding:8px 12px;border-radius:8px;cursor:pointer}
    button:disabled{opacity:.5;cursor:not-allowed}
    .sold{position:absolute;inset:0;background:rgba(0,0,0,0.5);color:white;display:flex;align-items:center;justify-content:center;border-radius:12px;font-weight:700;font-size:18px}
    aside{margin-top:18px;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 16px rgba(15,23,42,0.04)}
    .row{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .totals{font-weight:700;font-size:16px}
    .actions{display:flex;gap:10px;margin-top:8px}
    .small{font-size:13px;color:var(--muted)}

    @media(max-width:520px){.img{height:120px}.wrap{padding:12px}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Ordering — Clean demo</h1>
      <div class="small">Select quantities (limited by stock). Then download your PDF.</div>
    </header>

    <main>
      <section class="grid" id="products"></section>

      <aside id="cart">
        <div class="row"><div class="small">Items in cart</div><div id="itemCount" class="small">0</div></div>
        <div id="orderList"></div>
        <div class="row"><div class="small">Grand total</div><div id="grandTotal" class="totals">€0.00</div></div>
        <div class="actions">
          <button id="downloadPdf">Generate PDF</button>
          <button id="openEmail">Open email (summary)</button>
          <button id="reset">Reset</button>
        </div>
      </aside>
    </main>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <script>
    const products = [
      {id:'p1',name:'Classic Burger',desc:'200g beef · brioche bun · lettuce',price:5.5,stock:10,svg:`<svg viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg"><rect x="10" y="40" width="180" height="20" rx="8" fill="#E6A84A"/><rect x="20" y="20" width="160" height="20" rx="8" fill="#D97706"/><rect x="30" y="60" width="140" height="24" rx="8" fill="#6EE7B7"/><rect x="40" y="84" width="120" height="16" rx="6" fill="#8B5CF6"/></svg>`},
      {id:'p2',name:'Large Fries',desc:'Salted · 180g',price:2.8,stock:6,svg:`<svg viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg"><rect x="40" y="20" width="120" height="100" rx="14" fill="#FDE68A"/><rect x="60" y="30" width="16" height="60" rx="6" fill="#D97706"/><rect x="88" y="30" width="16" height="68" rx="6" fill="#D97706"/><rect x="116" y="30" width="16" height="55" rx="6" fill="#D97706"/></svg>`},
      {id:'p3',name:'Soft Drink 0.5L',desc:'Cold · Carbonated',price:1.9,stock:0,svg:`<svg viewBox="0 0 200 140" xmlns="http://www.w3.org/2000/svg"><rect x="80" y="10" width="40" height="100" rx="10" fill="#60A5FA"/><rect x="78" y="110" width="44" height="16" rx="6" fill="#111827"/></svg>`}
    ];

    const productsEl=document.getElementById('products');
    const orderListEl=document.getElementById('orderList');
    const grandTotalEl=document.getElementById('grandTotal');
    const itemCountEl=document.getElementById('itemCount');
    const downloadBtn=document.getElementById('downloadPdf');
    const openEmailBtn=document.getElementById('openEmail');
    const resetBtn=document.getElementById('reset');

    const state={};

    const formatPrice=n=>'€'+n.toFixed(2);

    function buildProducts(){
      productsEl.innerHTML='';
      products.forEach(p=>{
        const card=document.createElement('div');card.className='card';card.id='card-'+p.id;
        const img=document.createElement('div');img.className='img';img.innerHTML=p.svg;
        const titleRow=document.createElement('div');titleRow.className='meta';
        const title=document.createElement('div');title.innerHTML=`<div class="title">${p.name}</div><div class="desc">${p.desc}</div>`;
        const price=document.createElement('div');price.className='price';price.textContent=formatPrice(p.price);
        titleRow.appendChild(title);titleRow.appendChild(price);
        const controls=document.createElement('div');controls.className='controls';
        const qtyInput=document.createElement('input');qtyInput.type='number';qtyInput.min=0;qtyInput.max=p.stock;qtyInput.value=0;qtyInput.dataset.pid=p.id;
        qtyInput.addEventListener('input',onQtyChange);
        const stockInfo=document.createElement('div');stockInfo.className='small';stockInfo.textContent=p.stock>0?(`${p.stock} available`):'Sold out';
        controls.appendChild(qtyInput);controls.appendChild(stockInfo);
        card.appendChild(img);card.appendChild(titleRow);card.appendChild(controls);
        if(p.stock===0){const sold=document.createElement('div');sold.className='sold';sold.textContent='SOLD OUT';card.appendChild(sold);qtyInput.disabled=true;}
        productsEl.appendChild(card);
      });
    }

    function onQtyChange(e){
      const pid=e.target.dataset.pid;
      const val=Math.max(0,Math.min(parseInt(e.target.value||'0',10),products.find(p=>p.id===pid).stock));
      state[pid]=val>0?val:undefined;
      e.target.value=state[pid]||0;
      updateCart();
    }

    function updateCart(){
      orderListEl.innerHTML='';
      let grand=0,items=0;
      for(const pid in state){
        const qty=state[pid];
        if(!qty) continue;
        const prod=products.find(p=>p.id===pid);
        const lineTotal=qty*prod.price; grand+=lineTotal; items+=qty;
        const row=document.createElement('div');row.className='row';
        row.innerHTML=`<div><strong>${prod.name}</strong><div class="small">${prod.desc}</div></div><div style="text-align:right"><div>${qty} × ${formatPrice(prod.price)}</div><div class="small">${formatPrice(lineTotal)}</div></div>`;
        orderListEl.appendChild(row);
      }
      grandTotalEl.textContent=formatPrice(grand); itemCountEl.textContent=items;
      products.forEach(p=>{
        const qtyOrdered=state[p.id]||0;
        const card=document.getElementById('card-'+p.id);
        const soldOverlay=card.querySelector('.sold');
        const input=card.querySelector('input[type=number]');
        if(p.stock-qtyOrdered<=0){
          if(!soldOverlay){const sold=document.createElement('div');sold.className='sold';sold.textContent='SOLD OUT';card.appendChild(sold);}
          input.max=Math.max(0,p.stock-qtyOrdered); input.disabled=true;
          input.value=qtyOrdered;
        } else {if(soldOverlay){soldOverlay.remove();} input.max=p.stock-qtyOrdered; input.disabled=false;}
      });
    }

    async function generatePdf(){
      const printable=document.createElement('div');
      printable.style.padding='20px'; printable.style.fontFamily='Inter,Arial,Helvetica'; printable.style.background='white'; printable.style.width='800px';
      const header=document.createElement('div'); header.innerHTML=`<h2>Order Summary</h2><div>${new Date().toLocaleString()}</div><hr/>`;
      printable.appendChild(header);
      for(const pid in state){
        const qty=state[pid]; if(!qty) continue;
        const prod=products.find(p=>p.id===pid);
        const row=document.createElement('div');
        row.style.display='flex'; row.style.justifyContent='space-between'; row.style.margin='8px 0';
        const left=document.createElement('div'); left.innerHTML=`<div style="font-weight:600">${prod.name}</div><div style="font-size:12px;color:#6b7280">${prod.desc}</div>`;
        const right=document.createElement('div'); right.style.textAlign='right'; right.innerHTML=`${qty} × ${formatPrice(prod.price)}<div style="font-weight:700">${formatPrice(qty*prod.price)}</div>`;
        const imgWrap=document.createElement('div'); imgWrap.innerHTML=prod.svg; imgWrap.style.width='70px'; imgWrap.style.height='40px'; imgWrap.style.marginRight='12px'; imgWrap.style.display='inline-block';
        const leftWithImg=document.createElement('div'); leftWithImg.style.display='flex'; leftWithImg.style.alignItems='center'; leftWithImg.appendChild(imgWrap); leftWithImg.appendChild(left);
        row.appendChild(leftWithImg); row.appendChild(right);
        printable.appendChild(row);
      }
      const totalDiv=document.createElement('div'); totalDiv.style.marginTop='12px'; totalDiv.style.display='flex'; totalDiv.style.justifyContent='space-between'; totalDiv.style.fontWeight='700'; totalDiv.innerHTML=`<div>Grand total</div><div>${grandTotalEl.textContent}</div>`;
      printable.appendChild(totalDiv);
      document.body.appendChild(printable);
      const canvas=await html2canvas(printable,{scale:2});
      const imgData=canvas.toDataURL('image/png');
      const {jsPDF}=window.jspdf;
      const pdf=new jsPDF({orientation:'portrait',unit:'px',format:[canvas.width,canvas.height]});
      pdf.addImage(imgData,'PNG',0,0,canvas.width,canvas.height);
      pdf.save('order-summary.pdf');
      printable.remove();
    }

    function openEmail(){
      let body='Order summary%0A%0A'; let grand=0;
      for(const pid in state){
        const qty=state[pid]; if(!qty) continue; const prod=products.find(p=>p.id===pid);
        body+=`${prod.name} - ${qty} × ${formatPrice(prod.price)} = ${formatPrice(qty*prod.price)}%0A`; grand+=qty*prod.price;
      }
      body+=`%0AGrand total: ${formatPrice(grand)}%0A%0APlease find the attached PDF (if any) or use this summary when preparing the order.`;
      window.location.href=`mailto:?subject=Order%20Summary&body=${body}`;
    }

    function resetAll(){
      products.forEach(p=>{
        const input=document.querySelector(`input[data-pid="${p.id}"]`);
        input.value=0; input.disabled=p.stock===0; input.max=p.stock; delete state[p.id];
      });
      updateCart();
    }

    downloadBtn.addEventListener('click',async()=>{
      if(Object.keys(state).length===0){alert('Your cart is empty.'); return;}
      downloadBtn.disabled=true; downloadBtn.textContent='Generating...';
      try{await generatePdf();}catch(err){console.error(err); alert('PDF generation failed.');}
      downloadBtn.disabled=false; downloadBtn.textContent='Generate PDF';
    });

    openEmailBtn.addEventListener('click',()=>{
      if(Object.keys(state).length===0){alert('Cart is empty.'); return;}
      openEmail();
    });

    resetBtn.addEventListener('click',()=>{if(confirm('Reset all selections?')) resetAll();});

    buildProducts(); updateCart();
  </script>
</body>
</html>
